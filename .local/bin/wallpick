#!/bin/bash
# nsxiv-based wallpaper picker with random swww transition + Pywal + Waybar reload

# define wallpaper folder
WALL_DIR="$HOME/Pictures/wallpapers"

# random swww transition effects
effects=("grow" "wave" "any" "fade")
random_index=$(( RANDOM % ${#effects[@]} ))

# open nsxiv in thumbnail mode (-t) and print selected file(s) (-o)
img="$(nsxiv -to "$WALL_DIR" | head -n 1)"
[ -z "$img" ] && exit 0

# ensure swww-daemon is running
pgrep -x swww-daemon >/dev/null 2>&1 || { swww-daemon & sleep 0.3; }

# set wallpaper with random effect
swww img -t "${effects[random_index]}" "$img" --transition-duration 0.6 --transition-fps 60

# apply Pywal theme
wal -n -i "$img"
pkill hyprlock 2>/dev/null || true
~/.local/bin/wal-mako
ln -sf "$img" ~/.cache/wal/current_wallpaper
pywalfox update
# refresh Waybar to update colors
pkill -SIGUSR2 waybar 2>/dev/null || true
~/.local/bin/update-vscodium-theme.sh &


# save the last wallpaper path for restore
echo "$img" > ~/.cache/wal/last_wall

notify-send "Wallpaper applied" "$(basename "$img")"

